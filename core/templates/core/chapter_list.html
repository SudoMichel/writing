{% extends 'core/base.html' %}

{% block title %}Chapters - {{ project.name }}{% endblock %}

{% block content %}
<div class="section-header">
    <h2>Chapters in {{ project.name }}</h2>
    <a href="{% url 'chapter_create' project.id %}" class="btn">Create Chapter</a>
</div>

{% if chapters %}
    <div class="items-grid">
        {% for chapter in chapters %}
            <div class="item-card">
                <h3>Chapter {{ chapter.chapter_number }}: {{ chapter.title }}</h3>
                {% if chapter.point_of_view %}
                    <p class="item-type">POV: {{ chapter.point_of_view.name }}</p>
                {% endif %}
                <div class="item-body">
                    <p>{{ chapter.content|truncatewords:30 }}</p>
                    <div class="item-associations">
                        {% if chapter.plot_points.all %}
                            <p class="relation-tag">Plot points: {{ chapter.plot_points.count }}</p>
                        {% endif %}
                        {% if chapter.characters.all %}
                            <p class="relation-tag">Characters: {{ chapter.characters.all|join:", " }}</p>
                        {% endif %}
                        {% if chapter.places.all %}
                            <p class="relation-tag">Places: {{ chapter.places.all|join:", " }}</p>
                        {% endif %}
                        {% if chapter.organizations.all %}
                            <p class="relation-tag">Organizations: {{ chapter.organizations.all|join:", " }}</p>
                        {% endif %}
                    </div>
                </div>
                <div class="button-card">
                    <a href="{% url 'chapter_edit' project.id chapter.id %}" class="btn">Edit</a>
                    <a href="{% url 'chapter_delete' project.id chapter.id %}" class="btn">Delete</a>
                </div>
            </div>
        {% endfor %}
    </div>
{% else %}
    <p>No chapters created yet. <a href="{% url 'chapter_create' project.id %}">Add your first chapter</a>!</p>
{% endif %}

<div class="button-group">
    <a href="{% url 'project_edit' project.id %}" class="btn btn-secondary">Back to Project</a>
</div>
{% endblock %} 